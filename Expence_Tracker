import os
import json
import matplotlib.pyplot as plt


# Expense Class
class Expense:
    def __init__(self, category, amount):
        self.category = category
        self.amount = amount

    def __str__(self):
        return f"{self.category}: ${self.amount}"


# ExpenseManager Class
class ExpenseManager:
    def __init__(self, filename="expenses.json"):
        self.expenses = []
        self.filename = filename
        self.load_expenses()

    def add_expense(self, category, amount):
        expense = Expense(category, amount)
        self.expenses.append(expense)
        print("Expense added successfully!")

    def view_expenses(self):
        print("\nExpenses:")
        for i, expense in enumerate(self.expenses, 1):
            print(f"{i}. {expense}")
        print()

    def delete_expense(self, index):
        if 0 <= index < len(self.expenses):
            del self.expenses[index]
            print("Expense deleted successfully!")
        else:
            print("Invalid index!")

    def save_expenses(self):
        data = [{"category": exp.category, "amount": exp.amount} for exp in self.expenses]
        with open(self.filename, "w") as file:
            json.dump(data, file)
        print("Expenses saved successfully!")

    def load_expenses(self):
        if os.path.exists(self.filename):
            with open(self.filename, "r") as file:
                data = json.load(file)
                for item in data:
                    self.expenses.append(Expense(item["category"], item["amount"]))
            print("Expenses loaded successfully!")

    def generate_report(self):
        categories = {}
        for exp in self.expenses:
            categories[exp.category] = categories.get(exp.category, 0) + exp.amount

        labels = list(categories.keys())
        amounts = list(categories.values())

        plt.pie(amounts, labels=labels, autopct="%1.1f%%", startangle=140)
        plt.title("Expense Distribution")
        plt.show()


# Main Application
def main():
    manager = ExpenseManager()
    while True:
        print("\n--- Expense Tracker ---")
        print("1. Add Expense")
        print("2. View Expenses")
        print("3. Delete Expense")
        print("4. Save Expenses")
        print("5. Generate Report")
        print("6. Exit")
        choice = input("Enter your choice: ")

        if choice == "1":
            category = input("Enter category: ")
            amount = float(input("Enter amount: "))
            manager.add_expense(category, amount)
        elif choice == "2":
            manager.view_expenses()
        elif choice == "3":
            manager.view_expenses()
            index = int(input("Enter expense index to delete: ")) - 1
            manager.delete_expense(index)
        elif choice == "4":
            manager.save_expenses()
        elif choice == "5":
            manager.generate_report()
        elif choice == "6":
            manager.save_expenses()
            print("Goodbye!")
            break
        else:
            print("Invalid choice! Please try again.")


if __name__ == "__main__":
    main()